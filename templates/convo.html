<!-- # Mojia & Harshita
# final project
# draft version
# Dec 3, 2017 -->
<!-- !!!!! this page is not completed implemented yet! We will update the UI -->
<!-- this page shows the user a list of questions and allow the user to select what questions to answer
we will inplement audio file system to record the answers -->
{% extends "layout_2.html" %}

{% block content %}

	<div class='container' id='convo'>
			<div class="row">
			  <div class="col-lg-12 text-center">
			    <h4 class="section-heading"></h4>
			  </div>
			</div>
		<br><br>
		<audio class="col-lg-12 text-center" id="player" controls></audio>
		<br>
		<!-- <form method = "POST" action = "{{script}}"> -->
				<button type='submit' value ='Next' class="btn btn-primary" id='next'>Next</button>
		<!-- </form> -->

	</div>

	<script>
		var questions = {{questions | safe}};
		var index = 0;
		var convoId = 0;
		$('h4').text(questions[index]);
		$('#next').click(function(){
			index++;
			$('h4').text(questions[index]);
			if (index === questions.length) {
				$('#next').text('End Conversation');
			}
			if (index === questions.length+1) {
				$.ajax({
	            url: '/feedback/'+convoId,
	            data: convoId,
	            type: 'POST',
	            success: function(response) {
	                console.log(response);
									console.log('not working')
	            },
	            error: function(error) {
	                console.log(error);
	            }
	        });
			}
		});

		var player = document.getElementById('player');

		var handleSuccess = function(stream) {
		    if (window.URL) {
		      player.src = window.URL.createObjectURL(stream);
		    } else {
		      player.src = stream;
		    }
		  };

		  navigator.mediaDevices.getUserMedia({ audio: true, video: false })
		      .then(handleSuccess);

		// var handleSuccess = function(stream) {
		//     var context = new AudioContext();
		//     var source = context.createMediaStreamSource(stream);
		//     var processor = context.createScriptProcessor(1024, 1, 1);
		//
		//     source.connect(processor);
		//     processor.connect(context.destination);
		//
		//     processor.onaudioprocess = function(e) {
		//       // Do something with the data, i.e Convert this to WAV
		//       // console.log(e.inputBuffer);
		// 			stream = new mediaStream();
		// 			track = stream.getAudioTracks()
		// 			console.log(track)
		//     };
		//   };
		//
		//   navigator.mediaDevices.getUserMedia({ audio: true, video: false })
		//       .then(handleSuccess);

	</script>

{% endblock %}
